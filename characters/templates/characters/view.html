{% extends 'characters/base.html' %}
{% load humanize %}
{% load data_utilities %}
{% load static %}
{% block content %}
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/accounts/list">EQA Login Server</a></li>
                <li class="breadcrumb-item"><a href="/characters/list/{{ account.name }}">Characters</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ character.name }}</li>
            </ol>
        </nav>
        <div class="eq-window mt-4">
            <div class="row align-items-end" style="padding: 20px 0;">
                <div class="col-auto">
                    {% with "./images/eq-faces/"|add:face_image as face_image_static %}
                        <img style="background-color:#999; max-width: 150px;"
                             class="img-fluid img-thumbnail"
                             alt="Character Portrait"
                             src="{% static face_image_static %}">
                    {% endwith %}
                </div>

                <div class="col">
                    <div class="row align-items-end justify-content-end g-2">
                        <div class="col-auto">
                            <label for="character" class="mr-sm-2">Character Selection:</label>
                            <select class="eq-input form-control" aria-label="character"
                                    onchange="location = this.options[this.selectedIndex].value;"
                                    id="character"
                                    name="character">
                                {% for account in character_list.items %}
                                    {% for toon in account.1.characters.items %}
                                            <option value="/characters/view/{{ toon.1.char_name }}"
                                                    {% if toon.1.char_name == character.name %}selected{% endif %}>
                                                {{ toon.1.char_name }} (Account: {{ toon.1.account_name }})
                                            </option>
                                    {% endfor %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-auto">
                            <button class="eq-button-fancy" type="button"
                                    onclick="location = document.getElementById('character').value;"
                                    style="margin-bottom: 0;">
                                Go
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="eq-window-title-bar">{{ character.name }}&nbsp;{{ character.last_name }}</div>
            <nav class="eq-tab-box-fancy">
                <ul>
                    <li class="eq-tab-open" data-tab="data">Character</li>
                    <li data-tab="discovered-items">Discovered Items</li>
                    <li data-tab="faction">Faction</li>
                    {% if guild %}
                        <li data-tab="guild">Guild</li>
                    {% else %}
                        <li style="opacity: 0.5; cursor: default;">Guild</li>
                    {% endif %}
                    <li data-tab="inventory">Inventory</li>
                    <li data-tab="skills">Skills</li>
                    {% if character.class_name not in non_casters %}
                        <li data-tab="spells">Spells</li>
                    {% endif %}
                </ul>
            </nav>
            <div class="tabs-details">
                <div id="tab-data" class="tab-content active" aria-labelledby="data-tab" tabindex="0">
                        <div class="row" style="margin-bottom: 15px;">
                            <div class='WindowNestedTan col-md-6'>
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Details</h2>
                                </div>

                                {# Core Character Info #}
                                <div class="col">
                                    <span style="font-weight: bold">Level {{ character.level }}</span> {{ character.class_name|player_class }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Race:</span> {{ character.race|player_race }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Deity:</span> {{ character.deity|player_deity }}
                                </div>

                                {# Progression #}
                                <div class="col" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(123, 113, 74, 0.3);">
                                    <span style="font-weight: bold">Experience:</span> {{ character.exp|intcomma }}
                                </div>

                                {# Status Flags #}
                                <div class="col" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(123, 113, 74, 0.3);">
                                    <span style="font-weight: bold">Flagged PVP:</span> {{ character.pvp_status|yes_no }} &nbsp;|&nbsp;
                                    <span style="font-weight: bold">Anonymous:</span> {{ character.anon|yes_no }}
                                </div>

                                {# Titles - only show if they exist #}
                                {% if character.title or character.suffix %}
                                    <div class="col" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(123, 113, 74, 0.3);">
                                        {% if character.title %}
                                            <div><span style="font-weight: bold">Title:</span> {{ character.title }}</div>
                                        {% endif %}
                                        {% if character.suffix %}
                                            <div><span style="font-weight: bold">Suffix:</span> {{ character.suffix }}</div>
                                        {% endif %}
                                    </div>
                                {% endif %}

                                {# Guild - only show if in a guild #}
                                {% if guild %}
                                    <div class="col" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(123, 113, 74, 0.3);">
                                        <div><span style="font-weight: bold">Guild:</span> {{ guild.name }}</div>
                                        <div><span style="font-weight: bold">Guild Rank: </span> {{ guild.rank|guild_rank }}</div>
                                    </div>
                                {% endif %}
                            </div>
                            <div class='WindowNestedTan col-md-6'>
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Account Info</h2>
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Birthdate:</span> {{ birthday }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">First Logon:</span> {{ character.firstlogon }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Last Online:</span> {{ last_login|naturaltime }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Time Played:</span> {{ time_played }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">GM:</span> {{ character.gm|yes_no }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Status:</span> {{ account.status }}
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-bottom: 15px;">
                            <div class='WindowNestedTan col-md-4'>
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Stats</h2>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div><span style="font-weight: bold">STR:</span> {{ character.str }}</div>
                                        <div><span style="font-weight: bold">STA:</span> {{ character.sta }}</div>
                                        <div><span style="font-weight: bold">DEX:</span> {{ character.dex }}</div>
                                        <div><span style="font-weight: bold">AGI:</span> {{ character.agi }}</div>
                                    </div>
                                    <div class="col-6">
                                        <div><span style="font-weight: bold">INT:</span> {{ character.int_stat }}</div>
                                        <div><span style="font-weight: bold">WIS:</span> {{ character.wis }}</div>
                                        <div><span style="font-weight: bold">CHA:</span> {{ character.cha }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="WindowNestedTan col-md-4">
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Vitals</h2>
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">HP:</span> {{ character.cur_hp|intcomma }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Mana:</span> {{ character.mana|intcomma }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Fatigue:</span> {{ character.fatigue|intcomma }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Air:</span> {{ character.air_remaining|intcomma }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Hunger:</span> {{ character.hunger_level|intcomma }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Thirst:</span> {{ character.thirst_level|intcomma }}
                                </div>
                                <div class="col">
                                    <span style="font-weight: bold">Intoxication:</span> {{ character.intoxication|intcomma }}
                                </div>
                            </div>
                            <div class="WindowNestedTan col-md-4">
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Location</h2>
                                </div>
                                <div class="col align-self-center">
                                    <span style="font-weight: bold">Zone:</span> {{ character.zone_id|zone_filter:"long" }}
                                </div>
                                <div class="col align-self-center">
                                    <span style="font-weight: bold">X:</span> {{ character.x }}
                                </div>
                                <div class="col align-self-center">
                                    <span style="font-weight: bold">Y:</span> {{ character.y }}
                                </div>
                                <div class="col align-self-center">
                                    <span style="font-weight: bold">Z:</span> {{ character.z }}
                                </div>
                                <div class="col align-self-center">
                                    <span style="font-weight: bold">Heading:</span> {{ character.heading }}
                                </div>
                                {% if character.boatid and character.boatid != 0 %}
                                    <div class="col align-self-center pt-3" style="padding-top: 10px; margin-top: 5px; border-top: 1px solid rgba(123, 113, 74, 0.3);">
                                        <span style="font-weight: bold">BoatID:</span> {{ character.boatid }}
                                    </div>
                                    <div class="col align-self-center">
                                        <span style="font-weight: bold">Boat Name:</span> {{ character.boatname }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row" style="margin-bottom: 15px;">
                            <div class="WindowNestedTan col-md-6">
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Currency</h2>
                                </div>
                                <table class="eq-table eq-highlight-rows">
                                    <thead>
                                    <tr>
                                        <th scope="col"></th>
                                        <th style="color: #8aa3ff;">Body</th>
                                        <th style="color: #8aa3ff;">Cursor</th>
                                        <th style="color: #8aa3ff;">Bank</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <th scope="row">Platinum</th>
                                        <td>{{ character_currency.platinum|intcomma }}</td>
                                        <td>{{ character_currency.platinum_cursor|intcomma }}</td>
                                        <td>{{ character_currency.platinum_bank|intcomma }}</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Gold</th>
                                        <td>{{ character_currency.gold|intcomma }}</td>
                                        <td>{{ character_currency.gold_cursor|intcomma }}</td>
                                        <td>{{ character_currency.gold_bank|intcomma }}</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Silver</th>
                                        <td>{{ character_currency.silver|intcomma }}</td>
                                        <td>{{ character_currency.silver_cursor|intcomma }}</td>
                                        <td>{{ character_currency.silver_bank|intcomma }}</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Copper</th>
                                        <td>{{ character_currency.copper|intcomma }}</td>
                                        <td>{{ character_currency.copper_cursor|intcomma }}</td>
                                        <td>{{ character_currency.copper_bank|intcomma }}</td>
                                    </tr>
                                    </tbody>
                                </table>
                                <div class="col align-self-start">
                                    <span style="font-weight: bold">Auto-split Enabled:</span> {{ character.autosplit_enabled|yes_no }}
                                </div>
                            </div>
                            <div class="WindowNestedTan col-md-6">
                                <div class='WindowNestedTanTitleBar eq-header'>
                                    <h2>Keyring</h2>
                                </div>
                                {% if character_keyring %}
                                    <table class="eq-table eq-highlight-rows">
                                        <thead>
                                        <tr>
                                            <th>Key (Item Id)</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for item_id, key in character_keyring %}
                                            <tr>
                                                <td>{{ key }} ({{ item_id }})</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <div style="text-align: center;">You have no keys.</div>
                                {% endif %}
                            </div>
                        </div>
                    {% if 0 %}
                        <div class="row mt-4">
                            <div class="col">
                                <div class="card">
                                    <div class="card-header">Appearance</div>
                                    <div class="card-body">
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Gender:</span> {{ character.gender|gender }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Hair Style:</span> {{ character.hair_style }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Hair Color:</span> {{ character.hair_color }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Show Helm:</span> {{ character.showhelm|yes_no }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Face:</span> {{ character.face }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Left Eye:</span> {{ character.eye_color_1 }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Right Eye:</span> {{ character.eye_color_2 }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Beard:</span> {{ character.beard }}
                                        </div>
                                        <div class="col align-self-end">
                                            <span style="font-weight: bold">Beard Color:</span> {{ character.beard_color }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                <div class="row">
                    <div class="WindowNestedTan col-md-12">
                        <div class="WindowNestedTanTitleBar eq-header">
                            <h2>Alternate Advancement</h2>
                        </div>
                        <div class="row" style="margin-bottom: 15px;">
                            <div class="col-md-3">
                                <span style="font-weight: bold">AA Experience:</span> {{ character.aa_exp|intcomma }}
                            </div>
                            <div class="col-md-3">
                                <span style="font-weight: bold">AA Points:</span> {{ character.aa_points|intcomma }}
                            </div>
                            <div class="col-md-3">
                                <span style="font-weight: bold">AA Points Spent:</span> {{ character.aa_points_spent|intcomma }}
                            </div>
                            <div class="col-md-3">
                                <span style="font-weight: bold">Percent to AA:</span> {{ character.e_percent_to_aa }}%
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <div id="tab-discovered-items" class="tab-content" style="display: none;">
                    {% include "characters/discovered_items.html" %}
                </div>
                <div id="tab-faction" class="tab-content" style="display: none;">
                    {% include "characters/factions.html" %}
                </div>
                {% if guild is not None %}
                    <div id="tab-guild" class="tab-content" style="display: none;">
                        {% include 'characters/guild.html' %}
                    </div>
                {% endif %}
                <div id="tab-inventory" class="tab-content" style="display: none;">
                    {% include 'characters/inventory.html' %}
                </div>
                <div id="tab-skills" class="tab-content" style="display: none;">
                    {% include "characters/skills.html" %}
                </div>
                <div id="tab-spells" class="tab-content" style="display: none;">
                    {% if character.class_name not in non_casters %}
                        {% include "characters/spells.html" %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
